---
title: Bot Orchestrator – Operations
service: bot-orchestrator-api
status: active
last_reviewed: 2025-12-02
type: operations
---

## Deployment

- Containerized via Docker
- Exposes port `8005`
- Stateless service (no database)

## Configuration

### Environment Variables

- `ENGINE_CLUSTER_URL`: base URL for engine evaluate endpoint
- `BOT_CONFIG_URL`: base URL for bot config service (optional)
- `CHESS_KNOWLEDGE_URL`: base URL for opening/tablebase
- `HTTP_CLIENT_TIMEOUT_MS`: HTTP timeout (ms)
- `ENGINE_QUERY_TIMEOUT_SECONDS`: Engine query timeout (default: 20s)
- `KNOWLEDGE_QUERY_TIMEOUT_SECONDS`: Knowledge query timeout (default: 5s)
- `TOTAL_BOT_MOVE_TIMEOUT_SECONDS`: Total bot move timeout (default: 30s)

## Monitoring

### Metrics Endpoint

**Prometheus Metrics**: `GET /metrics` → Exports Prometheus-formatted metrics

### Key Metrics

#### HTTP Metrics
- `http_requests_total` - Total HTTP requests by method, endpoint, and status
- `http_request_latency_seconds` - Request latency histogram (p50, p95, p99)
- `http_errors_total` - HTTP error count by status code

#### Business Metrics
- `bot_moves_total` (counter) - Total bot moves generated by bot_id and status (success, timeout, fallback)
- `bot_move_latency_seconds` (histogram) - Bot move generation latency by bot_id
- `bot_move_timeouts_total` (counter) - Bot move timeouts by bot_id and timeout_type (engine, knowledge, total)
- `fallback_moves_total` (counter) - Fallback moves generated by reason (timeout, circuit_open, error)

#### External Service Metrics
- `external_service_calls_total` - External service calls by service and status
- `external_service_call_duration_seconds` - External service call duration by service

#### Circuit Breaker Metrics
- `circuit_breaker_state` - Circuit breaker state (0=closed, 1=open, 2=half-open) by service
- `circuit_breaker_failures_total` - Circuit breaker failures by service
- `circuit_breaker_transitions_total` - Circuit breaker state transitions by service and states

### Distributed Tracing

OpenTelemetry tracing is enabled and configured. Traces include:
- HTTP request/response spans
- External service call spans (engine-cluster-api, chess-knowledge-api)
- Bot move orchestration spans
- Timeout and fallback spans

Trace IDs are included in structured logs for correlation.

### Structured Logging

All logs are structured (JSON format) and include:
- Correlation IDs (from request headers)
- Trace IDs (from OpenTelemetry)
- Timestamp, log level, service name
- Contextual information (bot_id, game_id, position, etc.)

### Health Checks

**Liveness**: `GET /health` → 200 OK with service status

## Service Level Objectives (SLOs)

### Availability

- **Target**: 99.9% uptime (approximately 43 minutes downtime per month)
- **Measurement**: Service liveness endpoint (`/health`) responding with 200 OK
- **Alerting**: Alert if availability drops below 99.9% over a 30-day window

### Latency

- **Bot Move Generation**: p95 < 30s, p99 < 35s (with fallback)
  - Measures time from request to move response
  - Includes engine query, knowledge query, and orchestration time
  - Timeouts are enforced at 30s (total), 20s (engine), 5s (knowledge)
- **HTTP API Requests**: p95 < 500ms, p99 < 800ms (excluding bot move generation)
  - Measures API endpoint latency (not including bot move processing)

### Error Rate

- **Target**: < 0.1% error rate (5xx errors / total requests)
- **Measurement**: Count of 5xx responses divided by total requests
- **Note**: Fallback moves are considered successful (not errors)
- **Alerting**: Alert if error rate exceeds 0.5% over a 5-minute window

### Throughput

- **Bot Move Generation**: Handle 100 bot moves/second at peak
- **Fallback Rate**: < 5% of moves should use fallback (indicates dependency issues)

## Troubleshooting

### Common Issues

#### Issue: High timeout rate

**Symptoms**:
- `bot_move_timeouts_total` increasing
- `bot_move_latency_seconds` p95 approaching timeout thresholds

**Solution**:
1. Check engine-cluster-api health and latency
2. Check chess-knowledge-api health and latency
3. Review timeout configuration (may need adjustment)
4. Check network connectivity to external services
5. Review circuit breaker state (may be open due to failures)

#### Issue: High fallback move rate

**Symptoms**:
- `fallback_moves_total` > 5% of `bot_moves_total`
- Circuit breakers opening frequently

**Solution**:
1. Check engine-cluster-api availability (circuit breaker state)
2. Check chess-knowledge-api availability (circuit breaker state)
3. Review external service health and latency
4. Check for dependency service capacity issues
5. Verify timeout budgets are appropriate

#### Issue: Circuit breaker opening frequently

**Symptoms**:
- `circuit_breaker_state` = 1 (open) for extended periods
- `circuit_breaker_failures_total` increasing
- `circuit_breaker_transitions_total` showing frequent transitions

**Solution**:
1. Check dependent service health (engine-cluster-api, chess-knowledge-api)
2. Review network connectivity and latency
3. Check for service capacity issues
4. Review circuit breaker configuration (thresholds, timeout)
5. Verify dependency services are responding correctly

#### Issue: High error rate

**Symptoms**:
- `http_errors_total` counter increasing
- Error rate > 0.1%

**Solution**:
1. Check logs for error patterns (filter by trace_id)
2. Review external service call failures
3. Verify request payloads are valid
4. Check for rate limiting from external services
5. Review timeout configuration (may be too aggressive)

## Notes

- Bot moves are designed to complete within timeout budgets (30s total)
- Fallback moves (random legal moves) ensure games can progress even when dependencies fail
- Circuit breakers protect the service from cascading failures
- All external calls have individual timeout budgets and overall timeout protection
