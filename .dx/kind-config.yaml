---
# Kind Cluster Configuration for Local Development
# Reference: https://kind.sigs.k8s.io/docs/user/configuration/

kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4

name: monocto-dev

# Node configuration
nodes:
  # Control plane node
  - role: control-plane
    image: kindest/node:v1.28.0  # Match your k8s version needs
    extraPortMappings:
      # Ingress HTTP
      - containerPort: 80
        hostPort: 80
        listenAddress: "127.0.0.1"
        protocol: tcp
      # Ingress HTTPS
      - containerPort: 443
        hostPort: 443
        listenAddress: "127.0.0.1"
        protocol: tcp
    kubeadmConfigPatches:
      - |
        kind: InitConfiguration
        nodeRegistration:
          kubeletExtraArgs:
            system-reserved: memory=2Gi

  # Optional: worker nodes for more realistic testing
  # Uncomment to add additional capacity
  # - role: worker
  #   image: kindest/node:v1.28.0
  # - role: worker
  #   image: kindest/node:v1.28.0

# Networking configuration
networking:
  apiServerAddress: "127.0.0.1"
  apiServerPort: 6443
  podSubnet: "10.244.0.0/16"
  serviceSubnet: "10.96.0.0/12"

# Containerd configuration
containerd:
  configPatches:
    - |-
      [plugins."io.containerd.grpc.v1.cri"]
        enable_unprivileged_ports = true
        enable_unprivileged_icmp = true

# Feature gates (optional, for beta features)
# featureGates:
#   IPv6: true
